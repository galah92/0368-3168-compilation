JFlex_DIR         = FOLDER_0_JFlex
CUP_DIR           = FOLDER_1_CUP
SRC_DIR           = FOLDER_2_SRC
BIN_DIR           = FOLDER_3_BIN
INPUT_DIR         = FOLDER_4_INPUT
OUTPUT_DIR        = FOLDER_5_OUTPUT
EXPECTED_OUTPUT_DIR   = FOLDER_6_EXPECTED_OUTPUT
EXTERNAL_JARS_DIR = FOLDER_7_EXTERNAL_JARS
MANIFEST_DIR      = FOLDER_8_MANIFEST

# FILES #
JFlex_GENERATED_FILE      = ${SRC_DIR}/Lexer.java
CUP_GENERATED_FILES       = ${SRC_DIR}/Parser.java ${SRC_DIR}/TokenNames.java
JFlex_CUP_GENERATED_FILES = ${JFlex_GENERATED_FILE} ${CUP_GENERATED_FILES}
SRC_FILES                 = ${SRC_DIR}/*.java ${SRC_DIR}/AST/*.java
EXTERNAL_JAR_FILES        = ${EXTERNAL_JARS_DIR}/java-cup-11b-runtime.jar
MANIFEST_FILE             = ${MANIFEST_DIR}/MANIFEST.MF

# DEFINITIONS :: JFlex #
JFlex_PROGRAM  = jflex
JFlex_FLAGS    = -q
JFlex_DEST_DIR = ${SRC_DIR}
JFlex_FILE     = ${JFlex_DIR}/LEX_FILE.lex

# DEFINITIONS :: CUP #
CUP_PROGRAM                    = java -jar ${EXTERNAL_JARS_DIR}/java-cup-11b.jar 
CUP_FILE                       = ${CUP_DIR}/CUP_FILE.cup
CUP_GENERATED_PARSER_NAME      = Parser
CUP_GENERATED_SYMBOLS_FILENAME = TokenNames

# DEFINITIONS :: CUP #
CUP_FLAGS =                                \
-nowarn                                    \
-parser  ${CUP_GENERATED_PARSER_NAME}      \
-symbols ${CUP_GENERATED_SYMBOLS_FILENAME} 

# DEFINITIONS :: PARSER #
INPUT    = ${INPUT_DIR}/Input.txt
OUTPUT   = ${OUTPUT_DIR}/ParseStatus.txt

# TESTS
TEST_01_INPUT = ${INPUT_DIR}/TEST_01_Print_Primes.txt
TEST_02_INPUT = ${INPUT_DIR}/TEST_02_Bubble_Sort.txt
TEST_03_INPUT = ${INPUT_DIR}/TEST_03_Merge_Lists.txt
TEST_04_INPUT = ${INPUT_DIR}/TEST_04_Matrices.txt
TEST_05_INPUT = ${INPUT_DIR}/TEST_05_Classes.txt
TEST_06_INPUT = ${INPUT_DIR}/TEST_06_Print_Primes_Error.txt
TEST_07_INPUT = ${INPUT_DIR}/TEST_07_Bubble_Sort_Error.txt
TEST_08_INPUT = ${INPUT_DIR}/TEST_08_Merge_Lists_Error.txt
TEST_09_INPUT = ${INPUT_DIR}/TEST_09_Matrices_Error.txt
TEST_10_INPUT = ${INPUT_DIR}/TEST_10_Classes_Error.txt
TEST_01_OUTPUT = ${OUTPUT_DIR}/TEST_01_OUTPUT.txt
TEST_02_OUTPUT = ${OUTPUT_DIR}/TEST_02_OUTPUT.txt
TEST_03_OUTPUT = ${OUTPUT_DIR}/TEST_03_OUTPUT.txt
TEST_04_OUTPUT = ${OUTPUT_DIR}/TEST_04_OUTPUT.txt
TEST_05_OUTPUT = ${OUTPUT_DIR}/TEST_05_OUTPUT.txt
TEST_06_OUTPUT = ${OUTPUT_DIR}/TEST_06_OUTPUT.txt
TEST_07_OUTPUT = ${OUTPUT_DIR}/TEST_07_OUTPUT.txt
TEST_08_OUTPUT = ${OUTPUT_DIR}/TEST_08_OUTPUT.txt
TEST_09_OUTPUT = ${OUTPUT_DIR}/TEST_09_OUTPUT.txt
TEST_10_OUTPUT = ${OUTPUT_DIR}/TEST_10_OUTPUT.txt
TEST_01_EXPECTED_OUTPUT = ${EXPECTED_OUTPUT_DIR}/TEST_01_Print_Primes_Expected_Output.txt
TEST_02_EXPECTED_OUTPUT = ${EXPECTED_OUTPUT_DIR}/TEST_02_Bubble_Sort_Expected_Output.txt
TEST_03_EXPECTED_OUTPUT = ${EXPECTED_OUTPUT_DIR}/TEST_03_Merge_Lists_Expected_Output.txt
TEST_04_EXPECTED_OUTPUT = ${EXPECTED_OUTPUT_DIR}/TEST_04_Matrices_Expected_Output.txt
TEST_05_EXPECTED_OUTPUT = ${EXPECTED_OUTPUT_DIR}/TEST_05_Classes_Expected_Output.txt
TEST_06_EXPECTED_OUTPUT = ${EXPECTED_OUTPUT_DIR}/TEST_06_Print_Primes_Error_Expected_Output.txt
TEST_07_EXPECTED_OUTPUT = ${EXPECTED_OUTPUT_DIR}/TEST_07_Bubble_Sort_Error_Expected_Output.txt
TEST_08_EXPECTED_OUTPUT = ${EXPECTED_OUTPUT_DIR}/TEST_08_Merge_Lists_Error_Expected_Output.txt
TEST_09_EXPECTED_OUTPUT = ${EXPECTED_OUTPUT_DIR}/TEST_09_Matrices_Error_Expected_Output.txt
TEST_10_EXPECTED_OUTPUT = ${EXPECTED_OUTPUT_DIR}/TEST_10_Classes_Error_Expected_Output.txt

TEST_01 = \
java -jar PARSER ${TEST_01_INPUT} ${TEST_01_OUTPUT} \
dot -Tjpeg -o${OUTPUT_DIR}/TEST_01.jpeg ${OUTPUT_DIR}/AST_IN_GRAPHVIZ_DOT_FORMAT.txt \
diff TEST_01_OUTPUT TEST_01_EXPECTED_OUTPUT
TEST_02 = \
java -jar PARSER ${TEST_02_INPUT} ${TEST_02_OUTPUT} \
dot -Tjpeg -o${OUTPUT_DIR}/TEST_02.jpeg ${OUTPUT_DIR}/AST_IN_GRAPHVIZ_DOT_FORMAT.txt \
diff TEST_02_OUTPUT TEST_02_EXPECTED_OUTPUT
TEST_03 = \
java -jar PARSER ${TEST_03_INPUT} ${TEST_03_OUTPUT} \
dot -Tjpeg -o${OUTPUT_DIR}/TEST_03.jpeg ${OUTPUT_DIR}/AST_IN_GRAPHVIZ_DOT_FORMAT.txt \
diff TEST_03_OUTPUT TEST_03_EXPECTED_OUTPUT
TEST_04 = \
java -jar PARSER ${TEST_04_INPUT} ${TEST_04_OUTPUT} \
dot -Tjpeg -o${OUTPUT_DIR}/TEST_04.jpeg ${OUTPUT_DIR}/AST_IN_GRAPHVIZ_DOT_FORMAT.txt \
diff TEST_04_OUTPUT TEST_04_EXPECTED_OUTPUT
TEST_05 = \
java -jar PARSER ${TEST_05_INPUT} ${TEST_05_OUTPUT} \
dot -Tjpeg -o${OUTPUT_DIR}/TEST_05.jpeg ${OUTPUT_DIR}/AST_IN_GRAPHVIZ_DOT_FORMAT.txt \
diff TEST_05_OUTPUT TEST_05_EXPECTED_OUTPUT
TEST_06 = \
java -jar PARSER ${TEST_06_INPUT} ${TEST_06_OUTPUT} \
dot -Tjpeg -o${OUTPUT_DIR}/TEST_06.jpeg ${OUTPUT_DIR}/AST_IN_GRAPHVIZ_DOT_FORMAT.txt \
diff TEST_06_OUTPUT TEST_06_EXPECTED_OUTPUT
TEST_07 = \
java -jar PARSER ${TEST_07_INPUT} ${TEST_07_OUTPUT} \
dot -Tjpeg -o${OUTPUT_DIR}/TEST_07.jpeg ${OUTPUT_DIR}/AST_IN_GRAPHVIZ_DOT_FORMAT.txt \
diff TEST_07_OUTPUT TEST_07_EXPECTED_OUTPUT
TEST_08 = \
java -jar PARSER ${TEST_08_INPUT} ${TEST_08_OUTPUT} \
dot -Tjpeg -o${OUTPUT_DIR}/TEST_08.jpeg ${OUTPUT_DIR}/AST_IN_GRAPHVIZ_DOT_FORMAT.txt \
diff TEST_08_OUTPUT TEST_08_EXPECTED_OUTPUT
TEST_09 = \
java -jar PARSER ${TEST_09_INPUT} ${TEST_09_OUTPUT} \
dot -Tjpeg -o${OUTPUT_DIR}/TEST_09.jpeg ${OUTPUT_DIR}/AST_IN_GRAPHVIZ_DOT_FORMAT.txt \
diff TEST_09_OUTPUT TEST_09_EXPECTED_OUTPUT
TEST_10 = \
java -jar PARSER ${TEST_10_INPUT} ${TEST_10_OUTPUT} \
dot -Tjpeg -o${OUTPUT_DIR}/TEST_10.jpeg ${OUTPUT_DIR}/AST_IN_GRAPHVIZ_DOT_FORMAT.txt \
diff TEST_10_OUTPUT TEST_10_EXPECTED_OUTPUT


# TARGET #
all: clean
	$(JFlex_PROGRAM) ${JFlex_FLAGS} -d ${JFlex_DEST_DIR} ${JFlex_FILE}
	$(CUP_PROGRAM) ${CUP_FLAGS} -destdir ${SRC_DIR} ${CUP_FILE}
	javac -cp ${EXTERNAL_JAR_FILES} -d ${BIN_DIR} ${SRC_FILES}
	jar cfm PARSER ${MANIFEST_FILE} -C ${BIN_DIR} .
	java -jar PARSER ${INPUT} ${OUTPUT}
	dot -Tjpeg -o${OUTPUT_DIR}/AST.jpeg ${OUTPUT_DIR}/AST_IN_GRAPHVIZ_DOT_FORMAT.txt
#	cp ${OUTPUT_DIR}/AST.jpeg /mnt/c/Users/Gal/Downloads/
#	eog ${OUTPUT_DIR}/AST.jpeg &

test:
	$(JFlex_PROGRAM) ${JFlex_FLAGS} -d ${JFlex_DEST_DIR} ${JFlex_FILE}
	$(CUP_PROGRAM) ${CUP_FLAGS} -destdir ${SRC_DIR} ${CUP_FILE}
	javac -cp ${EXTERNAL_JAR_FILES} -d ${BIN_DIR} ${SRC_FILES}
	jar cfm PARSER ${MANIFEST_FILE} -C ${BIN_DIR} .
	$(TEST_01)
	$(TEST_02)
	$(TEST_03)
	$(TEST_04)
	$(TEST_05)
	$(TEST_06)
	$(TEST_07)
	$(TEST_08)
	$(TEST_09)
	$(TEST_10)

clean:
	rm -rf PARSER ${JFlex_CUP_GENERATED_FILES} ${BIN_DIR}/*.class ${BIN_DIR}/AST/*.class

